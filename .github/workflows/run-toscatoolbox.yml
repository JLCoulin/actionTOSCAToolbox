name: run-toscatoolbox
run-name: ${{ github.actor }} - syntax checking
on: [push]
jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - uses: docker-practice/actions-setup-docker@master
        timeout-minutes: 12
      # Get Orange-OpenSource/Cloudnet-TOSCA-toolbox code from github
      - run: |
          git clone https://github.com/Orange-OpenSource/Cloudnet-TOSCA-toolbox.git
          cd Cloudnet-TOSCA-toolbox/bin
          bash ./build.sh
      - run: |
          cd example
          _LOG=$(basename "$PWD")_BATCH_MODE-$(date +%F_%H-%M-%S).log
          for filename in $(find . -not -path "./${DeclarativeWorkflows_target_directory}/*" -iname '*.yaml' -o -iname '*.yml' | xargs grep -l 'tosca_definitions_version:') $(find . -iname '*.csar' -o -iname '*.zip')
            do
              echo -e "\n${normal}${magenta}    $(echo $filename | tr [a-z] [A-Z]) ${reset}" | tee -a logs/${_LOG}
              translate "$filename" 2>&1 | tee -a logs/"${_LOG}"
            done